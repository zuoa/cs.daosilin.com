<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{cup}} {{day}} æ•°æ®ç»Ÿè®¡</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
</head>
<body>
    <div class="container fade-in">
        <div class="header">
            <div class="header-decoration"></div>
            <h1 class="title">é²¨é±¼MajorS1æ•°æ®ç»Ÿè®¡</h1>
            <p class="subtitle"></p>
        </div>

        <div class="table-container">
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>åºå·</th>
                        <th>é€‰æ‰‹</th>
                        <th>åœºæ¬¡</th>
                        <th>èƒœåœº</th>
                        <th>èƒœç‡</th>
                        <th>K/D</th>
                        <th>Rating</th>
                        <th>ADPR</th>
                        <th>WE</th>
                        <th>çˆ†å¤´ç‡</th>
                        <th>MVP</th>
                        <th>æ€»å‡»æ€</th>
                        <th>æ€»æ­»äº¡</th>
                        <th>è¯¦æƒ…</th>
                    </tr>
                </thead>
                <tbody>
                    {% for player in players %}
                    <tr data-index="{{ loop.index }}" class="{% if loop.index % 2 == 0 %}even-row{% else %}odd-row{% endif %}">
                        <td>{{loop.index }} </td>
                        <td>
                            <div class="player-name">
                                {% if player.avatar %}
                                    <img src="https://wsrv.nl/?url={{ player.avatar }}" alt="{{ player.nickname }}" class="player-avatar" onerror="this.style.display='none'">
                                {% endif %}
                                {% if player.icon == 'trophy' %}
                                    <span class="trophy-icon">ğŸ†</span>
                                {% elif player.icon == 'shield' %}
                                    <span class="shield-icon">ğŸ›¡ï¸</span>
                                {% endif %}
                                {{ player.alias_name or player.nickname }}
                            </div>
                        </td>
                        <td>{{ player.match_count }}</td>
                        <td class="{% if player.win_count >= player.match_count * 0.7 %}rating-highlight{% endif %}">{{ player.win_count }}</td>
                        <td class="{% if player.win_rate >= 0.7 %}rating-highlight{% endif %}">{{ "%.1f"|format(player.win_rate * 100) }}%</td>
                        <td>{{ "%.2f"|format(player.kd_ratio) }}</td>
                        <td class="{% if player.avg_pw_rating >= 1.57 %}rating-highlight{% endif %}">{{ "%.2f"|format(player.avg_pw_rating) }}</td>
                        <td class="{% if player.avg_adpr >= 140 %}adr-highlight-1{% elif player.avg_adpr >= 120 %}adr-highlight-2{% elif player.avg_adpr >= 100 %}adr-highlight-3{% elif player.avg_adpr >= 80 %}adr-highlight-4{% else %}adr-highlight-5{% endif %}">{{ "%.2f"|format(player.avg_adpr) }}</td>
                        <td>{{ "%.2f"|format(player.avg_we) }}</td>
                        <td>{{ "%.1f"|format(player.avg_headshot_ratio * 100) }}%</td>
                        <td>{{ player.total_mvp }}</td>
                        <td>{{ player.total_kills }}</td>
                        <td>{{ player.total_deaths }}</td>
                        <td>
                            <span class="expand-icon" id="icon-{{ loop.index }}">â–¼</span>
                        </td>
                    </tr>
                    <tr class="drawer" id="drawer-{{ loop.index }}">
                        <td colspan="13">
                            <div class="drawer-content">
                                <div class="drawer-section">
                                    <h4>åŸºç¡€æ•°æ®</h4>
                                    <div class="drawer-item">
                                        <span class="drawer-label">èƒœåœºæ•°</span>
                                        <span class="drawer-value highlight">{{ player.win_count }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">èƒœç‡</span>
                                        <span class="drawer-value highlight">{{ "%.1f"|format(player.win_rate * 100) }}%</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">æ€»åŠ©æ”»</span>
                                        <span class="drawer-value">{{ player.total_assists }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">é¦–æ€</span>
                                        <span class="drawer-value">{{ player.total_first_kills }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">é¦–æ­»</span>
                                        <span class="drawer-value">{{ player.total_first_deaths }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">çˆ†å¤´æ•°</span>
                                        <span class="drawer-value">{{ player.total_headshots }}</span>
                                    </div>
                                </div>

                                <div class="drawer-section">
                                    <h4>å¤šæ€æ•°æ®</h4>
                                    <div class="drawer-item">
                                        <span class="drawer-label">2K</span>
                                        <span class="drawer-value">{{ player.total_2k }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">3K</span>
                                        <span class="drawer-value">{{ player.total_3k }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">4K</span>
                                        <span class="drawer-value">{{ player.total_4k }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">5K</span>
                                        <span class="drawer-value">{{ player.total_5k }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">å¤šæ€</span>
                                        <span class="drawer-value">{{ player.total_multi_kills }}</span>
                                    </div>
                                </div>

                                <div class="drawer-section">
                                    <h4>æ®‹å±€æ•°æ®</h4>
                                    <div class="drawer-item">
                                        <span class="drawer-label">1V2</span>
                                        <span class="drawer-value">{{ player.total_1v2 }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">1V3</span>
                                        <span class="drawer-value">{{ player.total_1v3 }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">1V4</span>
                                        <span class="drawer-value">{{ player.total_1v4 }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">1V5</span>
                                        <span class="drawer-value">{{ player.total_1v5 }}</span>
                                    </div>
                                </div>

                                <div class="drawer-section">
                                    <h4>æŠ•æ·ç‰©æ•°æ®</h4>
                                    <div class="drawer-item">
                                        <span class="drawer-label">é—ªå…‰å¼¹</span>
                                        <span class="drawer-value">{{ player.total_flashes }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">æˆåŠŸé—ªå…‰</span>
                                        <span class="drawer-value">{{ player.total_flash_success }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">é˜Ÿå‹é—ªå…‰</span>
                                        <span class="drawer-value">{{ player.total_flash_teammate }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">é—ªå…‰æˆåŠŸç‡</span>
                                        <span class="drawer-value">{{ "%.2f"|format(player.flash_success_ratio) }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">å‘½ä¸­æ•°</span>
                                        <span class="drawer-value">{{ player.total_hit_count }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">æŠ•æ·æ•°</span>
                                        <span class="drawer-value">{{ player.total_throws_count }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">ç‹™å‡»æ•°</span>
                                        <span class="drawer-value">{{ player.total_snipe_num }}</span>
                                    </div>
                                </div>

                                <div class="drawer-section">
                                    <h4>åœºå‡æ•°æ®</h4>
                                    <div class="drawer-item">
                                        <span class="drawer-label">åœºå‡å‡»æ€</span>
                                        <span class="drawer-value">{{ "%.2f"|format(player.avg_kills) }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">åœºå‡æ­»äº¡</span>
                                        <span class="drawer-value">{{ "%.2f"|format(player.avg_deaths) }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">åœºå‡åŠ©æ”»</span>
                                        <span class="drawer-value">{{ "%.2f"|format(player.avg_assists) }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">åœºå‡æŠ¤ç”²ä¼¤å®³</span>
                                        <span class="drawer-value">{{ "%.2f"|format(player.avg_damage_armar) }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">åœºå‡ç”Ÿå‘½ä¼¤å®³</span>
                                        <span class="drawer-value">{{ "%.2f"|format(player.avg_damage_health) }}</span>
                                    </div>
                                </div>

                                <div class="drawer-section">
                                    <h4>é«˜çº§æ•°æ®</h4>
                                    <div class="drawer-item">
                                        <span class="drawer-label">FK/FD</span>
                                        <span class="drawer-value">{{ "%.2f"|format(player.fk_fd_ratio) }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">PWR Rating</span>
                                        <span class="drawer-value">{{ "%.2f"|format(player.avg_pw_rating) }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">RWS</span>
                                        <span class="drawer-value">{{ "%.2f"|format(player.avg_rws) }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">WE</span>
                                        <span class="drawer-value">{{ "%.2f"|format(player.avg_we) }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">KAST</span>
                                        <span class="drawer-value">{{ "%.2f"|format(player.avg_kast) }}</span>
                                    </div>
                                    <div class="drawer-item">
                                        <span class="drawer-label">æ¯”èµ›MVP</span>
                                        <span class="drawer-value highlight">{{ player.match_mvp_count }}</span>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="footer">
            <div class="footer-content">
                <div class="footer-note">
                    æ•°æ®ç»Ÿè®¡ Â· å®æ—¶æ›´æ–° Â· ä¸“ä¸šåˆ†æ
                </div>
                <div class="watermark">
                    <span class="footer-icon">ğŸ“º</span>
                    Bç«™ <a href="https://space.bilibili.com/1148526945" target="_blank">ä¸»æ’­è®°å½•</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ä»URLä¸­æå–cupå’Œdayå‚æ•°
        function getUrlParams() {
            const pathParts = window.location.pathname.split('/').filter(part => part !== '');
            return {
                cup: pathParts[0] ? decodeURIComponent(pathParts[0]) : '2024ç§‹å­£èµ›',
                day: pathParts[1] ? decodeURIComponent(pathParts[1]) : 'Day 1'
            };
        }

        // æ›´æ–°é¡µé¢æ ‡é¢˜
        function updatePageTitle() {
            const params = getUrlParams();
            const titleElement = document.querySelector('.title');
            const subtitleElement = document.querySelector('.subtitle');

            if (titleElement) {
                titleElement.textContent = `${params.cup}`;
            }
            if (subtitleElement) {
                subtitleElement.textContent = `${params.day} æ•°æ®ç»Ÿè®¡`;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ›´æ–°æ ‡é¢˜
        document.addEventListener('DOMContentLoaded', function() {
            updatePageTitle();
        });

        function toggleDrawer(index) {
            const drawer = document.getElementById(`drawer-${index}`);
            const icon = document.getElementById(`icon-${index}`);
            const row = drawer.previousElementSibling;

            if (drawer.classList.contains('open')) {
                // å…³é—­æŠ½å±‰
                drawer.classList.remove('open');
                icon.classList.remove('rotated');
                row.classList.remove('expanded');
                icon.textContent = 'â–¼';

                // ç­‰å¾…åŠ¨ç”»å®Œæˆåéšè—å…ƒç´ 
                setTimeout(() => {
                    drawer.style.display = 'none';
                }, 300);
            } else {
                // å…³é—­å…¶ä»–å·²æ‰“å¼€çš„æŠ½å±‰
                const openDrawers = document.querySelectorAll('.drawer.open');
                openDrawers.forEach(openDrawer => {
                    openDrawer.classList.remove('open');
                    const openIcon = document.getElementById(openDrawer.id.replace('drawer-', 'icon-'));
                    const openRow = openDrawer.previousElementSibling;
                    openIcon.classList.remove('rotated');
                    openRow.classList.remove('expanded');
                    openIcon.textContent = 'â–¼';

                    // ç­‰å¾…åŠ¨ç”»å®Œæˆåéšè—å…ƒç´ 
                    setTimeout(() => {
                        openDrawer.style.display = 'none';
                    }, 300);
                });

                // æ‰“å¼€å½“å‰æŠ½å±‰
                drawer.style.display = 'table-row';
                // å¼ºåˆ¶é‡æ’ä»¥ç¡®ä¿åŠ¨ç”»ç”Ÿæ•ˆ
                drawer.offsetHeight;
                drawer.classList.add('open');
                icon.classList.add('rotated');
                row.classList.add('expanded');
                icon.textContent = 'â–²';
            }
        }

        // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†ç‚¹å‡»äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            const table = document.querySelector('.stats-table tbody');
            table.addEventListener('click', function(e) {
                const row = e.target.closest('tr[data-index]');
                if (row) {
                    const index = row.getAttribute('data-index');
                    toggleDrawer(index);
                }
            });
        });

        // æ·»åŠ é”®ç›˜æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const openDrawers = document.querySelectorAll('.drawer.open');
                openDrawers.forEach(drawer => {
                    drawer.classList.remove('open');
                    const icon = document.getElementById(drawer.id.replace('drawer-', 'icon-'));
                    const row = drawer.previousElementSibling;
                    icon.classList.remove('rotated');
                    row.classList.remove('expanded');
                    icon.textContent = 'â–¼';

                    // ç­‰å¾…åŠ¨ç”»å®Œæˆåéšè—å…ƒç´ 
                    setTimeout(() => {
                        drawer.style.display = 'none';
                    }, 300);
                });
            }
        });
    </script>
</body>
</html>
